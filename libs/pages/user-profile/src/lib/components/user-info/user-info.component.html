<h1 class="page-title">My Profile</h1>
<mat-card class="user-info-card">
  <form [formGroup]="form">
    <div class="user-info-wrapper">
      <div class="user-info-wrapper__left">
        <h2><strong>{{ userInfo()?.name ?? '-' }}</strong></h2>
        <div class="item">
          <div class="label">Email (Login ID)</div>
          <div class="value">{{ userInfo()?.account ?? '-' }}</div>
        </div>
        <div class="item">
          <div class="label">Password Management</div>
          <div class="value">
            <button type="button"
                    mat-stroked-button
                    color="primary"
                    class="btn"
                    (click)="onEditPassword()">
              Reset
            </button>
          </div>
          <div class="item">
            <div class="label">Multi-factor authentication (MFA)</div>
            <div class="value">
              <button type="button"
                      mat-stroked-button
                      color="primary"
                      class="btn"
                      (click)="onAddMfa()">
                Setting
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="user-info-wrapper__right">
        <section class="user-info-wrapper__right__section">
          <fieldset>
            <h2 class="user-info-wrapper__right__subtitle">Basic Information</h2>
            <div class="d-grid col-2">
              <mat-form-field appearance="outline"
                              floatLabel="always">
                <mat-label>User Name</mat-label>
                <input matInput
                       formControlName="name"
                       type="text"
                       maxlength="64" />
                @if (nameCtrl.hasError('required')) {
                <mat-error>Required.</mat-error>
                }
              </mat-form-field>
            </div>
            <div class="d-grid col-2">
              <mat-form-field appearance="outline"
                              floatLabel="always">
                <mat-label>Idle time (m)</mat-label>
                <mat-select formControlName="idleTimeout">
                  @for (idleTime of idleTimeOpts; track idleTime.value) {
                  <mat-option [value]="idleTime.value">{{ idleTime.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            <div class="d-grid col-2">
              <mat-form-field appearance="outline"
                              floatLabel="always">
                <mat-label>Default Project</mat-label>
                <mat-select formControlName="defaultProjectId">
                  @for (project of projectsOpts(); track project.id) {
                  <mat-option [value]="project.id">{{ project.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </fieldset>
          <fieldset>
            <h2 class="user-info-wrapper__right__subtitle">Language / Date Format</h2>
            <div class="d-grid col-2">
              <mat-form-field appearance="outline"
                              floatLabel="always">
                <mat-label>Language</mat-label>
                <mat-select formControlName="language">
                  @for (lang of langOpts | keyvalue; track lang.key) {
                  <mat-option [value]="lang.key">{{ lang.value }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline"
                              floatLabel="always">
                <mat-label>Date-Time Format</mat-label>
                <mat-select formControlName="dateTimeFormat">
                  @for (format of dateFormatOpts | keyvalue; track format.key) {
                  <mat-option [value]="format.key">{{ format.value }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </fieldset>
          <div class="user-info-action">
            @if (!isEditMode()) {
            <div class="edit-btn">
              <button type="button"
                      mat-stroked-button
                      color="primary"
                      class="btn"
                      (click)="onEdit()">
                <mat-icon svgIcon="icon:edit_primary"></mat-icon>
                Edit
              </button>
            </div>
            }
            @if (isEditMode()) {
            <div class="save-btn">
              <button type="button"
                      mat-stroked-button
                      color="primary"
                      (click)="onCancelEdit()">Cancel</button>
              <button type="button"
                      mat-flat-button
                      color="primary"
                      (click)="onSave()"
                      [disabled]="form.invalid || form.pristine">Save</button>
            </div>
            }
          </div>
        </section>
      </div>
    </div>
  </form>
</mat-card>